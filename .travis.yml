---
branches:
  only:
    - main
jobs:
  before_deploy:
    - "zip -r software-board *"
    - "mkdir -p deploy"
    - "mv software-board.zip deploy/software-board.zip"
  deploy:
    -
      access_key_id: $AWS_ACCESS_KEY
      acl: private
      bucket: software-board
      local_dir: deploy
      provider: s3
      region: ap-northeast-2
      secret_access_key: $AWS_SECRET_KEY
      skip_cleanup: true
      wait-until-deployed: true
  include:
    -
      cache:
        directories:
          - $HOME/.m2/repositroy
          - $HOME/.gradle
      install:
        - "chmod +x gradlew"
      jdk: openjdk14
      language: java
      script:
        - "./gradlew clean build"
    -
      before_script:
        - "cd frontend"
        - "npm install"
      cache: npm
      language: node_js
      node_js: 14
      script:
        - "npm run build"
language: java
notifications:
  email:
    recipients:
      - jeaun80@gmail.com
